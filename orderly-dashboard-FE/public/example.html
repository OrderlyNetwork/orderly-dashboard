<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="./stylesheets/bootstrap@5.3.2.min.css" rel="stylesheet" crossorigin="anonymous">
</head>
<body>
<div class="container text-center">
    <div class="row">
        <div class="col">
            <div></div>
        </div>
        <div class="col">

        </div>
        <div class="col">

        </div>
    </div>
</div>
<div class="container">
    <div><h1>Trading Metrics</h1></div>
    <div class="row">
        <div class="col">
            <canvas id="chart1"></canvas>
        </div>
        <div class="col">
            <canvas id="chart2"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart3"></canvas>
        </div>
        <div class="col">
            <canvas id="chart4"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart5"></canvas>
        </div>
        <div class="col">
            <canvas id="chart6"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart7"></canvas>
        </div>
        <div class="col">
            <canvas id="chart8"></canvas>
        </div>
    </div>
    <div><h1>User’s Metrics</h1></div>
    <div class="row">
        <div class="col">
            <canvas id="chart9"></canvas>
        </div>
        <div class="col">
            <canvas id="chart10"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart11"></canvas>
        </div>
        <div class="col">
            <canvas id="chart12"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart13"></canvas>
        </div>
        <div class="col">
            <canvas id="chart14"></canvas>
        </div>
    </div>
    <div class="row">
        <h1>Token’s Metrics</h1>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart15"></canvas>
        </div>
        <div class="col">
            <canvas id="chart16"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart17"></canvas>
        </div>
        <div class="col">
            <canvas id="chart18"></canvas>
        </div>
    </div>
<!--    <div class="row">-->
<!--        <div class="col">-->
<!--            <canvas id="chart1000"></canvas>-->
<!--        </div>-->
<!--        <div class="col">-->
<!--            <canvas id="chart1001"></canvas>-->
<!--        </div>-->
<!--    </div>-->
</div>

<script src="./javascripts/chart.js@4.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script>
    function dailyVolumeCallBack(respData) {
        console.log("dailyVolumeCallBack respData: ", respData);
        const chartData = respData["data"];
        const labels = chartData["daytime"];
        const data = chartData["volume"];
        const ctx1 = document.getElementById('chart1');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Daily volume',
                    data: data,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function tradingFeeCallBack(respData) {
        console.log("tradingFeeCallBack respData: ", respData);
        const chartData = respData["data"];
        const daytime = chartData["daytime"];
        const fee_amount = chartData["fee_amount"];
        let data = [];
        for (index = 0; index < daytime.length; index++) {
            data.push({x: daytime[index], y: fee_amount[index]});
        }
        const ctx2 = document.getElementById('chart2');
        new Chart(ctx2, {
            type: 'line',
            data: {
                datasets: [{
                    label: 'daily trading fee',
                    data: data
                }]
            }
        });
    }

    const ctx3 = document.getElementById('chart3');
    new Chart(ctx3, {
        type: 'line',
        data: {
            datasets: [{
                label: 'trading count',
                data: [{x: '2023-12-06', y: 20}, {x: '2023-12-07', y: 22}, {x: '2023-12-08', y: 24}, {x: '2023-12-09', y: 20}, {x: '2023-12-10', y: 21}, {x: '2023-12-11', y: 18}, {x: '2023-12-12', y: 25}]
            }]
        }
    });

    const ctx4 = document.getElementById('chart4');
    new Chart(ctx4, {
        type: 'line',
        data: {
            datasets: [{
                borderColor: '#FF6384',
                backgroundColor: '#FF6384',
                label: 'trading user count',
                data: [{x: '2023-12-06', y: 20}, {x: '2023-12-07', y: 22}, {x: '2023-12-08', y: 24}, {x: '2023-12-09', y: 20}, {x: '2023-12-10', y: 21}, {x: '2023-12-11', y: 18}, {x: '2023-12-12', y: 25}]
            }]
        }
    });

    function averageTradingCountCallBack(respData) {
        console.log("averageTradingCountCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx5 = document.getElementById('chart5');
        new Chart(ctx5, {
            type: 'bar',
            data: {
                labels: ['Past 24hours','Past 7Days', 'Past 30Days'],
                datasets: [{
                    label: 'Average Trading Count In Past 24 Hours/7Days/30Days',
                    data: [chartData["latest_day_metric"], chartData["latest_week_metric"], chartData["latest_month_metric"]],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }


    function averageTradingFeeCallBack(respData) {
        console.log("averageTradingFeeCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx6 = document.getElementById('chart6');
        new Chart(ctx6, {
            type: 'bar',
            data: {
                labels: ['Past 24hours','Past 7Days', 'Past 30Days'],
                datasets: [{
                    borderColor: '#ff9a63',
                    backgroundColor: '#ff9a63',
                    label: 'Average Trading Fee In Past 24 Hours/7Days/30Days',
                    data: [chartData["latest_day_metric"], chartData["latest_week_metric"], chartData["latest_month_metric"]],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function averageTradingVolumeCallBack(respData) {
        console.log("averageTradingVolumeCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx7 = document.getElementById('chart7');
        new Chart(ctx7, {
            type: 'bar',
            data: {
                labels: ['Past 24hours','Past 7Days', 'Past 30Days'],
                datasets: [{
                    borderColor: '#ff9a63',
                    backgroundColor: '#ff9a63',
                    label: 'Average Trading Fee In Past 24 Hours/7Days/30Days',
                    data: [chartData["latest_day_metric"], chartData["latest_week_metric"], chartData["latest_month_metric"]],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // ===== User metrics ====================
    function rankTradingVolume24hCallBack(respData) {
        console.log("averageTradingVolumeCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx9 = document.getElementById('chart9');
        new Chart(ctx9, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Daily Trading Volume Ranking In Past 24h',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function rankTradingVolume7dayCallBack(respData) {
        console.log("rankTradingVolume7dayCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx10 = document.getElementById('chart10');
        new Chart(ctx10, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Daily Trading Volume Ranking In Past 7Days',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function rankUserPerpHoldingCallBack(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx11 = document.getElementById('chart11');
        new Chart(ctx11, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Holding Ranking',
                    data: chartData["holding"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function rankUserPnl24hCallBack(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx11 = document.getElementById('chart12');
        new Chart(ctx11, {
            type: 'line',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Pnl Ranking In Past 24h',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }


    function rankUserPnl7dCallBack(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx11 = document.getElementById('chart13');
        new Chart(ctx11, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Pnl Ranking In Past 7Days',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }


    // ===== Token’s Metrics ====================
    function deposit_token_in_orderly(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];
        const ctx11 = document.getElementById('chart15');

        let daily_token = chartData["data"];
        console.log("daily_token="+daily_token)
        let deposit_data = [];
        for (let dailyTokenKey in daily_token) {
            console.log(daily_token[dailyTokenKey]["deposit_amount"])
            deposit_data.push(daily_token[dailyTokenKey]["deposit_amount"])
        }
        new Chart(ctx11, {
            type: 'line',
            data: {
                labels: chartData["daytime"],
                datasets: [{
                    borderColor: '#ff9a63',
                    backgroundColor: '#ff9a63',
                    label: 'Daily Deposit Amount In Orderly',
                    data: deposit_data,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function withdraw_token_in_orderly(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];
        let daily_token = chartData["data"];
        let withdraw_data = [];
        for (let dailyTokenKey in daily_token) {
            withdraw_data.push(daily_token[dailyTokenKey]["withdraw_amount"])
        }
        const ctx11 = document.getElementById('chart16');
        new Chart(ctx11, {
            type: 'line',
            data: {
                labels: chartData["daytime"],
                datasets: [{
                    borderColor: '#ff9a63',
                    backgroundColor: '#ff9a63',
                    label: 'Daily Withdraw Amount In Orderly',
                    data: withdraw_data,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }


    function deposit_ranking_in_orderly(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx11 = document.getElementById('chart17');
        new Chart(ctx11, {
            type: 'bar',
            data: {
                borderColor: '#ff9a63',
                backgroundColor: '#ff9a63',
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'Daily Deposit Amount Ranking In Past 24h',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function deposit_7d_in_orderly(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx11 = document.getElementById('chart18');
        new Chart(ctx11, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                borderColor: '#ff9a63',
                backgroundColor: '#ff9a63',
                datasets: [{
                    label: 'Daily Deposit Amount Ranking In Past 7Days',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // =======================================
    const data = {
        labels: [
            'Red',
            'Blue',
            'Yellow'
        ],
        datasets: [{
            label: 'My First Dataset',
            data: [300, 50, 100],
            backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)'
            ],
            hoverOffset: 4
        }]
    };


    const ctx1000 = document.getElementById('chart1000');
    // https://www.chartjs.org/docs/latest/charts/doughnut.html
    new Chart(ctx1000, {
        type: 'doughnut',
        data: data,
    });

    var apiConfig;
    var xhr1 = new XMLHttpRequest();
    xhr1.open('GET', 'http://localhost:3000/api'+ '?t='+ (new Date()).getTime().toString());
    xhr1.send();

    xhr1.onreadystatechange = function() {
        if (xhr1.readyState == 4 && xhr1.status == 200) {
            console.log(xhr1.responseText);
            apiConfig = JSON.parse(xhr1.responseText);
            apiConfigCallback(apiConfig);
        } else {
            console.warn("xhr1 response: ", xhr1.responseText);
        }
    };

    function apiConfigCallback(apiConfig) {
        let baseUrl = apiConfig["analyzer_api"];
        let dailyVolume = baseUrl+"/daily_volume";
        console.log("apiConfig.analyzer_api/dailyVolume=", dailyVolume);
        var xhr2 = new XMLHttpRequest();
        xhr2.open('GET', dailyVolume);
        xhr2.send();
        xhr2.onreadystatechange = function() {
            if (xhr2.readyState == 4 && xhr2.status == 200) {
                dailyVolumeCallBack(JSON.parse(xhr2.responseText));
                console.log(xhr2.responseText);
            } else {
                console.warn("xhr2 response: ", xhr2.responseText);
            }
        };

        let tradingFeeApi = baseUrl +"/daily_trading_fee";
        console.log("apiConfig.analyzer_api/tradingFeeApi=", tradingFeeApi);
        var xhr3 = new XMLHttpRequest();
        xhr3.open('GET', tradingFeeApi);
        xhr3.send();
        xhr3.onreadystatechange = function() {
            if (xhr3.readyState == 4 && xhr3.status == 200) {
                tradingFeeCallBack(JSON.parse(xhr3.responseText));
                console.log(xhr3.responseText);
            } else {
                console.warn("xhr3 response: ", xhr3.responseText);
            }
        };

        let averageTradingCountApi = baseUrl +"/average_trading_count";
        console.log("apiConfig.analyzer_api/averageTradingCountApi=", averageTradingCountApi);
        var xhr4 = new XMLHttpRequest();
        xhr4.open('GET', averageTradingCountApi);
        xhr4.send();
        xhr4.onreadystatechange = function() {
            if (xhr4.readyState == 4 && xhr4.status == 200) {
                averageTradingCountCallBack(JSON.parse(xhr4.responseText));
                console.log(xhr4.responseText);
            } else {
                console.warn("xhr4 response: ", xhr4.responseText);
            }
        };

        let averageTradingFeeApi = baseUrl +"/average_trading_fee";
        console.log("apiConfig.analyzer_api/averageTradingFeeApi=", averageTradingFeeApi);
        var xhr5 = new XMLHttpRequest();
        xhr5.open('GET', averageTradingFeeApi);
        xhr5.send();
        xhr5.onreadystatechange = function() {
            if (xhr5.readyState == 4 && xhr5.status == 200) {
                averageTradingFeeCallBack(JSON.parse(xhr5.responseText));
                console.log(xhr5.responseText);
            } else {
                console.warn("xhr5 response: ", xhr5.responseText);
            }
        };

        let averageTradingVolumeApi = baseUrl +"/average_trading_volume";
        console.log("apiConfig.analyzer_api/averageTradingVolumeApi=", averageTradingVolumeApi);
        var xhr6 = new XMLHttpRequest();
        xhr6.open('GET', averageTradingFeeApi);
        xhr6.send();
        xhr6.onreadystatechange = function() {
            if (xhr6.readyState == 4 && xhr6.status == 200) {
                averageTradingVolumeCallBack(JSON.parse(xhr6.responseText));
                console.log(xhr6.responseText);
            } else {
                console.warn("xhr6 response: ", xhr6.responseText);
            }
        };

        // user's metrics
        let rankTradingVolumeApi24h = baseUrl +"/ranking/trading_volume" + "?days=1";
        console.log("apiConfig.analyzer_api/rankTradingVolumeApi24h=", rankTradingVolumeApi24h);
        var xhr7 = new XMLHttpRequest();
        xhr7.open('GET', rankTradingVolumeApi24h);
        xhr7.send();
        xhr7.onreadystatechange = function() {
            if (xhr7.readyState == 4 && xhr7.status == 200) {
                rankTradingVolume24hCallBack(JSON.parse(xhr7.responseText));
                console.log(xhr7.responseText);
            } else {
                console.warn("xhr7 response: ", xhr7.responseText);
            }
        };

        let rankTradingVolumeApi27day = baseUrl +"/ranking/trading_volume" + "?days=7";
        console.log("apiConfig.analyzer_api/rankTradingVolumeApi27day=", rankTradingVolumeApi27day);
        var xhr8 = new XMLHttpRequest();
        xhr8.open('GET', rankTradingVolumeApi27day);
        xhr8.send();
        xhr8.onreadystatechange = function() {
            if (xhr8.readyState == 4 && xhr8.status == 200) {
                rankTradingVolume7dayCallBack(JSON.parse(xhr8.responseText));
                console.log(xhr8.responseText);
            } else {
                console.warn("xhr8 response: ", xhr8.responseText);
            }
        };

        // ranking/perp_holding
        let rankPerpHoldingApi = baseUrl +"/ranking/perp_holding";
        console.log("apiConfig.analyzer_api/rankPerpHoldingApi=", rankPerpHoldingApi);
        var xhr9 = new XMLHttpRequest();
        xhr9.open('GET', rankPerpHoldingApi);
        xhr9.send();
        xhr9.onreadystatechange = function() {
            if (xhr9.readyState == 4 && xhr9.status == 200) {
                rankUserPerpHoldingCallBack(JSON.parse(xhr9.responseText));
                console.log(xhr9.responseText);
            } else {
                console.warn("xhr9 response: ", xhr8.responseText);
            }
        };



        // ranking/24h pnl
        let rank24hApi = baseUrl +"/ranking/pnl?days=1";
        var xhr10 = new XMLHttpRequest();
        xhr10.open('GET', rank24hApi);
        xhr10.send();
        xhr10.onreadystatechange = function() {
            if (xhr10.readyState == 4 && xhr10.status == 200) {
                rankUserPnl24hCallBack(JSON.parse(xhr10.responseText));
                console.log(xhr10.responseText);
            } else {
                console.warn("xhr9 response: ", xhr10.responseText);
            }
        };


        // ranking/7d pnl
        let rank7dApi = baseUrl +"/ranking/pnl?days=7";
        var xhr11 = new XMLHttpRequest();
        xhr11.open('GET', rank7dApi);
        xhr11.send();
        xhr11.onreadystatechange = function() {
            if (xhr11.readyState == 4 && xhr11.status == 200) {
                rankUserPnl7dCallBack(JSON.parse(xhr11.responseText));
                console.log(xhr11.responseText);
            } else {
                console.warn("xhr9 response: ", xhr11.responseText);
            }
        };


        // ranking/7d pnl
        let depositApi = baseUrl +"/daily_orderly_token";
        var xhr12 = new XMLHttpRequest();
        xhr12.open('GET', depositApi);
        xhr12.send();
        xhr12.onreadystatechange = function() {
            if (xhr12.readyState == 4 && xhr12.status == 200) {
                deposit_token_in_orderly(JSON.parse(xhr12.responseText));
                console.log(xhr12.responseText);
            } else {
                console.warn("xhr12 response: ", xhr12.responseText);
            }
        };

        // ranking/7d pnl
        let withdrawApi = baseUrl +"/daily_orderly_token";
        var xhr13 = new XMLHttpRequest();
        xhr13.open('GET', withdrawApi);
        xhr13.send();
        xhr13.onreadystatechange = function() {
            if (xhr13.readyState == 4 && xhr13.status == 200) {
                withdraw_token_in_orderly(JSON.parse(xhr13.responseText));
                console.log(xhr13.responseText);
            } else {
                console.warn("xhr13 response: ", xhr13.responseText);
            }
        };

        // ranking/7d pnl
        let deposit_rank_Api = baseUrl +"/ranking/deposit?days=10";
        var xhr14 = new XMLHttpRequest();
        xhr14.open('GET', deposit_rank_Api);
        xhr14.send();
        xhr14.onreadystatechange = function() {
            if (xhr14.readyState == 4 && xhr14.status == 200) {
                deposit_ranking_in_orderly(JSON.parse(xhr14.responseText));
                console.log(xhr14.responseText);
            } else {
                console.warn("xhr9 response: ", xhr14.responseText);
            }
        };

        // ranking/7d pnl
        let deposit_7d_rank_Api = baseUrl +"/ranking/deposit?days=70";
        var xhr15 = new XMLHttpRequest();
        xhr15.open('GET', deposit_7d_rank_Api);
        xhr15.send();
        xhr15.onreadystatechange = function() {
            if (xhr15.readyState == 4 && xhr15.status == 200) {
                deposit_7d_in_orderly(JSON.parse(xhr15.responseText));
                console.log(xhr15.responseText);
            } else {
                console.warn("xhr15 response: ", xhr15.responseText);
            }
        };
    }
</script>
</body>
</html>