<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="./stylesheets/bootstrap@5.3.2.min.css" rel="stylesheet" crossorigin="anonymous">
</head>
<body>
<div class="container text-center">
    <div class="row">
        <div class="col">
            <div>Column</div>
        </div>
        <div class="col">
            Column
        </div>
        <div class="col">
            Column
        </div>
    </div>
</div>
<div class="container">
    <div>Trading Metrics</div>
    <div class="row">
        <div class="col">
            <canvas id="chart1"></canvas>
        </div>
        <div class="col">
            <canvas id="chart2"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart3"></canvas>
        </div>
        <div class="col">
            <canvas id="chart4"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart5"></canvas>
        </div>
        <div class="col">
            <canvas id="chart6"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart7"></canvas>
        </div>
        <div class="col">
            <canvas id="chart8"></canvas>
        </div>
    </div>
    <div>User’s Metrics</div>
    <div class="row">
        <div class="col">
            <canvas id="chart9"></canvas>
        </div>
        <div class="col">
            <canvas id="chart10"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart11"></canvas>
        </div>
        <div class="col">
            <canvas id="chart12"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart13"></canvas>
        </div>
        <div class="col">
            <canvas id="chart14"></canvas>
        </div>
    </div>
    <div class="row">
        Token’s Metrics
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart15"></canvas>
        </div>
        <div class="col">
            <canvas id="chart16"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart17"></canvas>
        </div>
        <div class="col">
            <canvas id="chart18"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <canvas id="chart1000"></canvas>
        </div>
        <div class="col">
            <canvas id="chart1001"></canvas>
        </div>
    </div>
</div>

<script src="./javascripts/chart.js@4.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script>
    function dailyVolumeCallBack(respData) {
        console.log("dailyVolumeCallBack respData: ", respData);
        const chartData = respData["data"];
        const labels = chartData["daytime"];
        const data = chartData["volume"];
        const ctx1 = document.getElementById('chart1');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Daily volume',
                    data: data,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function tradingFeeCallBack(respData) {
        console.log("tradingFeeCallBack respData: ", respData);
        const chartData = respData["data"];
        const daytime = chartData["daytime"];
        const fee_amount = chartData["fee_amount"];
        let data = [];
        for (index = 0; index < daytime.length; index++) {
            data.push({x: daytime[index], y: fee_amount[index]});
        }
        const ctx2 = document.getElementById('chart2');
        new Chart(ctx2, {
            type: 'line',
            data: {
                datasets: [{
                    label: 'daily trading fee',
                    data: data
                }]
            }
        });
    }

    const ctx3 = document.getElementById('chart3');
    new Chart(ctx3, {
        type: 'line',
        data: {
            datasets: [{
                label: 'trading count',
                data: [{x: '2023-12-06', y: 20}, {x: '2023-12-07', y: 22}, {x: '2023-12-08', y: 24}, {x: '2023-12-09', y: 20}, {x: '2023-12-10', y: 21}, {x: '2023-12-11', y: 18}, {x: '2023-12-12', y: 25}]
            }]
        }
    });

    const ctx4 = document.getElementById('chart4');
    new Chart(ctx4, {
        type: 'line',
        data: {
            datasets: [{
                borderColor: '#FF6384',
                backgroundColor: '#FF6384',
                label: 'trading user count',
                data: [{x: '2023-12-06', y: 20}, {x: '2023-12-07', y: 22}, {x: '2023-12-08', y: 24}, {x: '2023-12-09', y: 20}, {x: '2023-12-10', y: 21}, {x: '2023-12-11', y: 18}, {x: '2023-12-12', y: 25}]
            }]
        }
    });

    function averageTradingCountCallBack(respData) {
        console.log("averageTradingCountCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx5 = document.getElementById('chart5');
        new Chart(ctx5, {
            type: 'bar',
            data: {
                labels: ['Past 24hours','Past 7Days', 'Past 30Days'],
                datasets: [{
                    label: 'Average Trading Count In Past 24 Hours/7Days/30Days',
                    data: [chartData["latest_day_metric"], chartData["latest_week_metric"], chartData["latest_month_metric"]],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }


    function averageTradingFeeCallBack(respData) {
        console.log("averageTradingFeeCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx6 = document.getElementById('chart6');
        new Chart(ctx6, {
            type: 'bar',
            data: {
                labels: ['Past 24hours','Past 7Days', 'Past 30Days'],
                datasets: [{
                    borderColor: '#ff9a63',
                    backgroundColor: '#ff9a63',
                    label: 'Average Trading Fee In Past 24 Hours/7Days/30Days',
                    data: [chartData["latest_day_metric"], chartData["latest_week_metric"], chartData["latest_month_metric"]],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function averageTradingVolumeCallBack(respData) {
        console.log("averageTradingVolumeCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx7 = document.getElementById('chart7');
        new Chart(ctx7, {
            type: 'bar',
            data: {
                labels: ['Past 24hours','Past 7Days', 'Past 30Days'],
                datasets: [{
                    borderColor: '#ff9a63',
                    backgroundColor: '#ff9a63',
                    label: 'Average Trading Fee In Past 24 Hours/7Days/30Days',
                    data: [chartData["latest_day_metric"], chartData["latest_week_metric"], chartData["latest_month_metric"]],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // ===== User metrics ====================
    function rankTradingVolume24hCallBack(respData) {
        console.log("averageTradingVolumeCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx9 = document.getElementById('chart9');
        new Chart(ctx9, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Daily Trading Volume Ranking In Past 24h',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function rankTradingVolume7dayCallBack(respData) {
        console.log("rankTradingVolume7dayCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx10 = document.getElementById('chart10');
        new Chart(ctx10, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Daily Trading Volume Ranking In Past 7Days',
                    data: chartData["volume"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function rankUserPerpHoldingCallBack(respData) {
        console.log("rankUserPerpHoldingCallBack respData: ", respData);
        const chartData = respData["data"];

        const ctx11 = document.getElementById('chart11');
        new Chart(ctx11, {
            type: 'bar',
            data: {
                labels: chartData["account_ids"],
                datasets: [{
                    label: 'User’s Holding Ranking',
                    data: chartData["holding"],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    const ctx12 = document.getElementById('chart12');
    new Chart(ctx12, {
        type: 'bar',
        data: {
            labels: ['address1', 'address2', 'address3','address4', 'address5','address6', 'address7', 'address8','address9', 'address10'],
            datasets: [{
                borderColor: '#ff9a63',
                backgroundColor: '#ff9a63',
                label: 'User’s Pnl Ranking In Past 24h',
                data: [368000.00, 358000.00, 348000.00, 308000.00, 268000.00, 248000.00, 218000.00, 208000.00, 178000.00, 158000.00],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const ctx13 = document.getElementById('chart13');
    new Chart(ctx13, {
        type: 'bar',
        data: {
            labels: ['address1', 'address2', 'address3','address4', 'address5','address6', 'address7', 'address8','address9', 'address10'],
            datasets: [{
                borderColor: '#ff9a63',
                backgroundColor: '#ff9a63',
                label: 'User’s Pnl Ranking In Past 7Days',
                data: [3680000.50, 3580000.60, 3480000.00, 3080000.00, 2680000.80, 2480000.90, 2180000.88, 2080000.96, 1780000.32, 1580000.58],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    // ===== Token’s Metrics ====================
    const ctx15 = document.getElementById('chart15');
    new Chart(ctx15, {
        type: 'line',
        data: {
            datasets: [{
                label: 'Daily Deposit Amount In Orderly',
                data: [{x: '2023-12-06', y: 10000000.0}, {x: '2023-12-07', y: 11000000.0}, {x: '2023-12-08', y: 12500000.0}, {x: '2023-12-09', y: 15000000.0}, {x: '2023-12-10', y: 19000000.0}, {x: '2023-12-11', y: 21500000.0}, {x: '2023-12-12', y: 26500000.0}]
            }]
        }
    });

    const ctx16 = document.getElementById('chart16');
    new Chart(ctx16, {
        type: 'line',
        data: {
            datasets: [{
                label: 'Daily Withdraw Amount In Orderly',
                data: [{x: '2023-12-06', y: 1000000.0}, {x: '2023-12-07', y: 1100000.0}, {x: '2023-12-08', y: 1150000.0}, {x: '2023-12-09', y: 1200000.0}, {x: '2023-12-10', y: 1100000.0}, {x: '2023-12-11', y: 1150000.0}, {x: '2023-12-12', y: 1060000.0}]
            }]
        }
    });

    const ctx17 = document.getElementById('chart17');
    new Chart(ctx17, {
        type: 'bar',
        data: {
            labels: ['address1', 'address2', 'address3','address4', 'address5','address6', 'address7', 'address8','address9', 'address10'],
            datasets: [{
                borderColor: '#ff9a63',
                backgroundColor: '#ff9a63',
                label: 'Daily Deposit Amount Ranking In Past 24h',
                data: [368000.50, 358000.60, 348000.00, 308000.00, 268000.80, 248000.90, 218000.88, 208000.96, 178000.32, 158000.58],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const ctx18 = document.getElementById('chart18');
    new Chart(ctx18, {
        type: 'bar',
        data: {
            labels: ['address1', 'address2', 'address3','address4', 'address5','address6', 'address7', 'address8','address9', 'address10'],
            datasets: [{
                borderColor: '#ff9a63',
                backgroundColor: '#ff9a63',
                label: 'Daily Deposit Amount Ranking In Past 7Days',
                data: [668000.50, 658000.60, 634800.00, 608000.00, 528000.80, 488000.90, 428000.88, 408000.96, 348000.32, 308000.58],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    // =======================================
    const data = {
        labels: [
            'Red',
            'Blue',
            'Yellow'
        ],
        datasets: [{
            label: 'My First Dataset',
            data: [300, 50, 100],
            backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)'
            ],
            hoverOffset: 4
        }]
    };


    const ctx1000 = document.getElementById('chart1000');
    // https://www.chartjs.org/docs/latest/charts/doughnut.html
    new Chart(ctx1000, {
        type: 'doughnut',
        data: data,
    });

    var apiConfig;
    var xhr1 = new XMLHttpRequest();
    xhr1.open('GET', 'http://localhost:3000/api'+ '?t='+ (new Date()).getTime().toString());
    xhr1.send();

    xhr1.onreadystatechange = function() {
        if (xhr1.readyState == 4 && xhr1.status == 200) {
            console.log(xhr1.responseText);
            apiConfig = JSON.parse(xhr1.responseText);
            apiConfigCallback(apiConfig);
        } else {
            console.warn("xhr1 response: ", xhr1.responseText);
        }
    };

    function apiConfigCallback(apiConfig) {
        let baseUrl = apiConfig["analyzer_api"];
        let dailyVolume = baseUrl+"/daily_volume";
        console.log("apiConfig.analyzer_api/dailyVolume=", dailyVolume);
        var xhr2 = new XMLHttpRequest();
        xhr2.open('GET', dailyVolume);
        xhr2.send();
        xhr2.onreadystatechange = function() {
            if (xhr2.readyState == 4 && xhr2.status == 200) {
                dailyVolumeCallBack(JSON.parse(xhr2.responseText));
                console.log(xhr2.responseText);
            } else {
                console.warn("xhr2 response: ", xhr2.responseText);
            }
        };

        let tradingFeeApi = baseUrl +"/daily_trading_fee";
        console.log("apiConfig.analyzer_api/tradingFeeApi=", tradingFeeApi);
        var xhr3 = new XMLHttpRequest();
        xhr3.open('GET', tradingFeeApi);
        xhr3.send();
        xhr3.onreadystatechange = function() {
            if (xhr3.readyState == 4 && xhr3.status == 200) {
                tradingFeeCallBack(JSON.parse(xhr3.responseText));
                console.log(xhr3.responseText);
            } else {
                console.warn("xhr3 response: ", xhr3.responseText);
            }
        };

        let averageTradingCountApi = baseUrl +"/average_trading_count";
        console.log("apiConfig.analyzer_api/averageTradingCountApi=", averageTradingCountApi);
        var xhr4 = new XMLHttpRequest();
        xhr4.open('GET', averageTradingCountApi);
        xhr4.send();
        xhr4.onreadystatechange = function() {
            if (xhr4.readyState == 4 && xhr4.status == 200) {
                averageTradingCountCallBack(JSON.parse(xhr4.responseText));
                console.log(xhr4.responseText);
            } else {
                console.warn("xhr4 response: ", xhr4.responseText);
            }
        };

        let averageTradingFeeApi = baseUrl +"/average_trading_fee";
        console.log("apiConfig.analyzer_api/averageTradingFeeApi=", averageTradingFeeApi);
        var xhr5 = new XMLHttpRequest();
        xhr5.open('GET', averageTradingFeeApi);
        xhr5.send();
        xhr5.onreadystatechange = function() {
            if (xhr5.readyState == 4 && xhr5.status == 200) {
                averageTradingFeeCallBack(JSON.parse(xhr5.responseText));
                console.log(xhr5.responseText);
            } else {
                console.warn("xhr5 response: ", xhr5.responseText);
            }
        };

        let averageTradingVolumeApi = baseUrl +"/average_trading_volume";
        console.log("apiConfig.analyzer_api/averageTradingVolumeApi=", averageTradingVolumeApi);
        var xhr6 = new XMLHttpRequest();
        xhr6.open('GET', averageTradingFeeApi);
        xhr6.send();
        xhr6.onreadystatechange = function() {
            if (xhr6.readyState == 4 && xhr6.status == 200) {
                averageTradingVolumeCallBack(JSON.parse(xhr6.responseText));
                console.log(xhr6.responseText);
            } else {
                console.warn("xhr6 response: ", xhr6.responseText);
            }
        };

        // user's metrics
        let rankTradingVolumeApi24h = baseUrl +"/ranking/trading_volume" + "?days=1";
        console.log("apiConfig.analyzer_api/rankTradingVolumeApi24h=", rankTradingVolumeApi24h);
        var xhr7 = new XMLHttpRequest();
        xhr7.open('GET', rankTradingVolumeApi24h);
        xhr7.send();
        xhr7.onreadystatechange = function() {
            if (xhr7.readyState == 4 && xhr7.status == 200) {
                rankTradingVolume24hCallBack(JSON.parse(xhr7.responseText));
                console.log(xhr7.responseText);
            } else {
                console.warn("xhr7 response: ", xhr7.responseText);
            }
        };

        let rankTradingVolumeApi27day = baseUrl +"/ranking/trading_volume" + "?days=7";
        console.log("apiConfig.analyzer_api/rankTradingVolumeApi27day=", rankTradingVolumeApi27day);
        var xhr8 = new XMLHttpRequest();
        xhr8.open('GET', rankTradingVolumeApi27day);
        xhr8.send();
        xhr8.onreadystatechange = function() {
            if (xhr8.readyState == 4 && xhr8.status == 200) {
                rankTradingVolume7dayCallBack(JSON.parse(xhr8.responseText));
                console.log(xhr8.responseText);
            } else {
                console.warn("xhr8 response: ", xhr8.responseText);
            }
        };

        // ranking/perp_holding
        let rankPerpHoldingApi = baseUrl +"/ranking/perp_holding";
        console.log("apiConfig.analyzer_api/rankPerpHoldingApi=", rankPerpHoldingApi);
        var xhr9 = new XMLHttpRequest();
        xhr9.open('GET', rankPerpHoldingApi);
        xhr9.send();
        xhr9.onreadystatechange = function() {
            if (xhr9.readyState == 4 && xhr9.status == 200) {
                rankUserPerpHoldingCallBack(JSON.parse(xhr9.responseText));
                console.log(xhr9.responseText);
            } else {
                console.warn("xhr9 response: ", xhr8.responseText);
            }
        };
    }
</script>
</body>
</html>